# Using checklist to generate a dataset to finetune the distilbert-base-cased-distilled-quad

This experiment uses the [Checklist tool](https://github.com/marcotcr/checklist) which aims to test NLP models just like behavioral software tests. \
â€‹
The most part of the code was retrieved from https://github.com/marcotcr/checklist/tree/master/notebooks and https://github.com/sophiamyang/NLP_testing

## The experiment goal

Checklist was used to test the [`distilbert-base-cased-distilled-squad`](https://huggingface.co/distilbert-base-cased-distilled-squad) model. From these generated tests, it was created a new dataset to finetune the [`distilbert-base-uncased`](https://huggingface.co/distilbert-base-uncased) with the goal of minimize the test failure rate.

## Explaining the notebooks

1. The [1. SQuAD-create-test-suite.ipynb](https://github.com/filipegl/checklist_SQuAD_exp/blob/main/1.%20SQuAD-create-test-suite.ipynb) works like a tutorial showing the checklist's power. It generates a lot of tests, it saves all tests into a *.pkl* file.
2. The [2. SQuAD-run-test-suite.ipynb](https://github.com/filipegl/checklist_SQuAD_exp/blob/main/2.%20SQuAD-run-test-suite.ipynb) runs the test suite saved in the previous notebook. Here we can see a summary of all tests.
3. The [3. SQuAD-get-checklist-data.ipynb](https://github.com/filipegl/checklist_SQuAD_exp/blob/main/3.%20SQuAD-get-checklist-data.ipynb) aims to create a train file using the text generated by checklist mixed with the original [SQuAD dataset](https://huggingface.co/datasets/squad).
4. The [4. SQuAD-train.ipynb](https://github.com/filipegl/checklist_SQuAD_exp/blob/main/4.%20SQuAD-train.ipynb) gets the file generated in the previous notebook and finetunes the [`distilbert-base-uncased`](https://huggingface.co/distilbert-base-uncased). The goal is to create a new model capable with a better performance in the checklist tests. We call this model Biased_SQuAD.
5. The [5. biased_SQuAD-run-test-suite.ipynb](https://github.com/filipegl/checklist_SQuAD_exp/blob/main/5.%20biased_SQuAD-run-test-suite.ipynb) runs the test suite created in the notebook 1, but using the Biased_SQuAD predicitons.

## distilbert-base-cased-distilled-squad vs biased_SQuAD

The table below shows the comparison between the two models and their failure rates in each test.

| Test names by capability | SQuAD (Failure Rate %) | biased_SQuAD (Failure Rate %) |
| --- | --- | --- |
| **Vocabulary** |  |  |
| A is COMP than B. Who is more COMP? | $4.0\%%%$ | $\colorbox{green}{0.0\%}$ |
| A is COMP than B. Who is less COMP? | $98.0\%$ | $\colorbox{green}{12.0\%}$ |
| Intensifiers (very, super, extremely) and reducers (somewhat, kinda, etc)? | $100.0\%$ | $\colorbox{green}{1.0\%}$ |
| **Taxonomy** |  |  |
| size, shape, age, color | $98.0\%$ | $\colorbox{green}{0.0\%}$ |
| Profession vs nationality | $25.0\%$ | $\colorbox{green}{0.0\%}$ |
| Animal vs Vehicle | $62.0\%$ | $\colorbox{green}{0.0\%}$ |
| Animal vs Vehicle v2 | $64.0\%$ | $\colorbox{green}{0.0\%}$ |
| Synonyms | $13.0\%$ | $\colorbox{green}{0.0\%}$ |
| A is COMP than B. Who is antonym(COMP)? B | $100.0\%$ | $\colorbox{green}{8.0\%}$ |
| A is more X than B. Who is more antonym(X)? B. Who is less X? B. Who is more X? A. Who is less antonym(X)? A. | $100.0\%$ | $\colorbox{green}{99.0\%}$ |
| **Robustness** |  |  |
| Question typo | $11.0\%$ | $\colorbox{#d00000}{22.0%}$ |
| Question contractions | $9.0\%$ | $\colorbox{green}{6.0\%}$ |
| Add random sentence to context | $10.0\%$ | $\colorbox{#d00000}{28.0\%}$ |
| **NER** |  |  |
| Change name everywhere | $7.0\%$ | $\colorbox{#d00000}{9.0\%}$ |
| Change location everywhere | $5.0\%$ | $\colorbox{#d00000}{10.0\%}$ |
| **Fairness** |  |  |
| M/F failure rates should be similar for different professions | $85.0\%$ | $\colorbox{green}{0.0\%}$ |
| **Temporal** |  |  |
| There was a change in profession | $1.0\%$ | $\colorbox{green}{0.0\%}$ |
| Understanding before / after -> first / last. | $100.0\%$ | $\colorbox{green}{0.0\%}$ |
| Negation |  |  |
| Negation in context, may or may not be in question | $93.0\%$ | $\colorbox{green}{0.0\%}$ |
| Negation in question only. | $100.0\%$ | $\colorbox{green}{0.0\%}$ |
| **Coref** |  |  |
| Basic coref, he / she | $100.0\%$ | $\colorbox{green}{1.0\%}$ |
| Basic coref, his / her | $98.0\%$ | $\colorbox{green}{0.0\%}$ |
| Former / Latter | $100.0\%$ | $\colorbox{green}{0.0\%}$ |
| **SRL** |  |  |
| Agent / object distinction | $69.0\%$ | $\colorbox{#d00000}{97.0\%}$ |
| Agent / object distinction with 3 agents | $98.0\%$ | $\colorbox{green}{96.0\%}$ |
